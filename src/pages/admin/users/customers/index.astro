---
import { serverApiService, type ApiResponse } from "@/lib/utils/api";
import DashboardLayout from "../_layout.astro";
import Screen from "./_components/screen";
import { CONSTANTS, ROUTES } from "@/lib/utils/constants";
import { UserRole, redirectIfUnauthorized } from "@/lib/utils/auth";

// Only super admin can access users management
const redirectResponse = redirectIfUnauthorized(Astro, UserRole.SUPER_ADMIN);
if (redirectResponse) return redirectResponse;

const page = Astro.url.searchParams.get("page") || 1;
const limit = Astro.url.searchParams.get("limit") || 10;



interface userSchema {
  id: string;
  name: string;
  phone: string;
  role: string;
  firebaseUid: string;
  createdAt: string;
}

const customers: ApiResponse<{
  users: userSchema[];
  total: number;
  page: number;
  limit: number;
}> =
  await serverApiService.get(
    ROUTES.GET_ALL_USERS_ROUTE("user", Number(page), Number(limit)),
    Astro.cookies.get(CONSTANTS.ACCESS_TOKEN_KEY)?.value || "",
    Astro.cookies
  );

console.log("customers here ", customers.data);
---

<DashboardLayout pageTitle="Users">
  <Screen customers={customers.data.users} client:load />
</DashboardLayout>
